<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Data Logging - MAV'RIC Library</title>
    <meta name="description" content="Highway to the Danger Zone" />
    <meta name="author" content="MAV'RIC Team">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
    <a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank" id="github-ribbon" class="hidden-print"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
<div class="container-fluid fluid-height wrapper">
    <div class="navbar navbar-static-top hidden-print">
        <div class="container-fluid">
            <a class="brand navbar-brand pull-left" href="../index.html">MAV'RIC Library</a>
        </div>
    </div>
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <!-- Navigation -->
                <ul class='nav nav-list'><li class=''><a href="../Getting_Started.html">Getting Started</a></li><li class=''><a href="../User_Guide/index.html" class="folder">User Guide</a><ul class='nav nav-list'></ul></li><li class=''><a href="../Toolchain/index.html" class="folder">Toolchain</a><ul class='nav nav-list'><li class=''><a href="../Toolchain/AVR32_compiler.html">AVR32 compiler</a></li><li class=''><a href="../Toolchain/AVR32_Bootloader.html">AVR32 Bootloader</a></li><li class=''><a href="../Toolchain/AVR32_DFU_Programming.html">AVR32 DFU Programming</a></li><li class=''><a href="../Toolchain/STM32.html">STM32</a></li><li class=''><a href="../Toolchain/Emulation.html">Emulation</a></li><li class=''><a href="../Toolchain/Test_Toolchains.html">Test Toolchains</a></li></ul></li><li class='open'><a href="../Developper_Guide/index.html" class="folder">Developper Guide</a><ul class='nav nav-list'><li class=''><a href="../Developper_Guide/Create_New_Telemetry_Messages.html">Create New Telemetry Messages</a></li><li class='active'><a href="../Developper_Guide/Data_Logging.html">Data Logging</a></li><li class=''><a href="../Developper_Guide/Code_style.html">Code style</a></li></ul></li><li class=''><a href="#" class="aj-nav folder">Contributing</a><ul class='nav nav-list'><li class=''><a href="../Contributing/Contribute_to_the_Documentation.html">Contribute to the Documentation</a></li><li class=''><a href="../Contributing/Development_Workflow.html">Development Workflow</a></li></ul></li><li class=''><a href="#" class="aj-nav folder">Pages From Wiki</a><ul class='nav nav-list'><li class=''><a href="../Pages_From_Wiki/Calibration-Bias-Factors.html">Calibration-Bias-Factors</a></li><li class=''><a href="../Pages_From_Wiki/Calibration-Scale-Factors.html">Calibration-Scale-Factors</a></li><li class=''><a href="../Pages_From_Wiki/Connect-a-Joystick-to-QGroundControl.html">Connect-a-Joystick-to-QGroundControl</a></li><li class=''><a href="../Pages_From_Wiki/Debug-via-minicom-software-on-Linux.html">Debug-via-minicom-software-on-Linux</a></li><li class=''><a href="../Pages_From_Wiki/Download-Firmware.html">Download-Firmware</a></li><li class=''><a href="../Pages_From_Wiki/Download-Git-Tools.html">Download-Git-Tools</a></li><li class=''><a href="../Pages_From_Wiki/Download-IDE.html">Download-IDE</a></li><li class=''><a href="../Pages_From_Wiki/Download-QGroundcontrol.html">Download-QGroundcontrol</a></li><li class=''><a href="../Pages_From_Wiki/Electronic-board.html">Electronic-board</a></li><li class=''><a href="../Pages_From_Wiki/FAQ.html">FAQ</a></li><li class=''><a href="../Pages_From_Wiki/First-Steps-Binding-your-Remote.html">First-Steps-Binding-your-Remote</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-CDC-and-DFU-Drivers-issue-on-Windows.html">First-steps-CDC-and-DFU-Drivers-issue-on-Windows</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-Connect-to-QGroundControl.html">First-steps-Connect-to-QGroundControl</a></li><li class=''><a href="../Pages_From_Wiki/First-steps-pairing-XBee-modules.html">First-steps-pairing-XBee-modules</a></li><li class=''><a href="../Pages_From_Wiki/Flashing-a-microcontroller-for-the-first-time.html">Flashing-a-microcontroller-for-the-first-time</a></li><li class=''><a href="../Pages_From_Wiki/Home.html">Home</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Building-Steps.html">Quad-Assembly-Building-Steps</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Part-List.html">Quad-Assembly-Part-List</a></li><li class=''><a href="../Pages_From_Wiki/Quad-Assembly-Remote-Pairing.html">Quad-Assembly-Remote-Pairing</a></li><li class=''><a href="../Pages_From_Wiki/Remote-settings.html">Remote-settings</a></li></ul></li></ul>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://github.com/lis-epfl/MAVRIC_Library/archive/master.zip" target="_blank">Download</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library" target="_blank">GitHub Repo</a><br><a href="https://github.com/lis-epfl/MAVRIC_Library/issues" target="_blank">Help/Support/Bugs</a><br><a href="http://lis-epfl.github.io/MAVRIC_Library/doxygen/classes.html" target="_blank">Doxygen Documentation</a><br>
                        <!-- Twitter -->
                        
                        <hr/>
                    
                    <p><small>Documentation generated by <a href="http://daux.io">Daux.io</a></small></p>
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">
            <div class="content-page">
                <article>
            <div class="page-header sub-header clearfix">
            <h1><a href="../Developper_Guide/index.html">Developper Guide</a> <i class="glyphicon glyphicon-chevron-right"></i> <a href="../Developper_Guide/Data_Logging.html">Data Logging</a>            </h1>
                    <span style="float: left; font-size: 10px; color: gray;">
                        Thursday, April 14, 2016                    </span>
                    <span style="float: right; font-size: 10px; color: gray;">
                        6:44 PM                    </span>
        </div>
    
    <h1>Logging on onboard SD card</h1>
<h3>Preparation</h3>
<p>Hardware:</p>
<ul>
<li>format a micro SD card in fat32. With the power disconnected board</li>
<li>insert the SD card in the slot which is on the bottom face of the autopilot, below the Xbee module.</li>
</ul>
<p>Software:</p>
<ul>
<li>make sure the data_logging module is created and initialised in central_data.</li>
<li>chose which variables to log, this is done in mavlink_telemetry.c, in the function:
<code>bool mavlink_telemetry_add_data_logging_parameters(data_logging_t* data_logging)</code>.</li>
</ul>
<p>You should then compile and flash the new code on the autopilot.</p>
<h3>Usage:</h3>
<ul>
<li>open QGroundControl Software,</li>
<li>connect your platform.</li>
<li>go in one of the menu which is not too overcrowded such as <code>Plan</code> or <code>Fly</code>.</li>
<li>then, go in the top menu <code>Advanced-&gt;Tool Widgets-&gt;Custom Commands</code>.</li>
</ul>
<p>A new panel should appear on the window. You shall be able to <code>select a QML file</code>.</p>
<ul>
<li>browth to <code>Your_PATH_TO\MAVRIC\Utilities\QGroundControl\</code>
</li>
<li>select the qml file called <code>Start_Stop_Log</code>
</li>
</ul>
<p>This will add two buttons on the custom command. One for starting the log, the other to stop it.</p>
<hr />
<h1>Logging on ground computer (via QGroundControl)</h1>
<h3>Preparation</h3>
<p>For this you need to have the autopilot sending the corresponding variable through <a href="https://github.com/lis-epfl/mavlink">mavlink</a></p>
<p>Thus, go in the file <code>mavlink_telemetry.c</code>, and edit the function <code>mavric_telemetry_init()</code></p>
<p>Here is an example of one line of this function :</p>
<pre><code class="language-cpp">init_success &amp;= mavlink_communication_add_msg_send( mavlink_communication, 
                                                    500000, 
                                                    RUN_REGULAR,  
                                                    PERIODIC_ABSOLUTE, 
                                                    PRIORITY_NORMAL,
                                                    (mavlink_send_msg_function_t)&amp;bmp085_telemetry_send_pressure,
                                                    &amp;central_data-&gt;pressure, 
                                                    MAVLINK_MSG_ID_SCALED_PRESSURE	);// ID 29
</code></pre>
<p>Important points:</p>
<ul>
<li>make sure that the variable you want to log is activated with the parameter <code>RUN_REGULAR</code>. (with <code>RUN_NEVER</code>, the variable will not be sent to the ground computer).</li>
<li>adjust the period in micro-seconds at which you want to update that variable.</li>
<li>make sure the structure given as 7th argument (<code>&amp;central_data-&gt;pressure</code> in the example above) corresponds to what is expected by the function given as 6th argument (<code>&amp;bmp085_telemetry_send_pressure</code> in the example above)</li>
</ul>
<h3>Usage</h3>
<ul>
<li>start the autopilot</li>
<li>open QGroundControl</li>
<li>connect to your platform.</li>
<li>Go in <code>Analyze</code> menu</li>
<li>Select the variables you want to log</li>
<li>And then press on <code>Start Logging</code> at the very bottom of the <code>Analyze</code> menu page.</li>
<li>Chose the location and name of the file you want to log.
You are Done !!</li>
</ul>
<p>At the end of the log, QGroundControl will ask you whether empty values should be filled with previous one or with zeros. It is because variables are not updated at the same frequency. I suggest to select <code>fill with previous value</code> not to introduce discontinuity within the log.</p>

        <nav>
        <ul class="pager">
            <li><a href="../Developper_Guide/Create_New_Telemetry_Messages.html">Previous</a></li>            <li><a href="../Developper_Guide/Code_style.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    

    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>
    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>
</body>
</html>
